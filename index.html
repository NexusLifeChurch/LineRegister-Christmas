<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NxLife Community</title>
    
    <!-- Libraries -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Config & Styles -->
    <style>
        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #3e2723 0%, #5d4037 50%, #8d6e63 100%);
            min-height: 100vh;
            color: #3e2723;
        }

        /* Glassmorphism Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        /* Micro-interactions */
        .btn-coffee {
            background: linear-gradient(45deg, #3e2723, #5d4037);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-coffee:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(62, 39, 35, 0.4);
        }

        .btn-coffee:active {
            transform: scale(0.98);
        }

        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #efebe9;
        }
        
        .input-field:focus {
            border-color: #8d6e63;
            box-shadow: 0 0 0 4px rgba(141, 110, 99, 0.1);
            outline: none;
        }

        /* Loading Spinner */
        .coffee-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #d7ccc8;
            border-top: 5px solid #3e2723;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Fade In Animation */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-[#3e2723] z-50 flex flex-col items-center justify-center text-white">
        <div class="coffee-spinner mb-4"></div>
        <p class="animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <!-- Completed Message (Hidden by default) -->
    <div id="completedMessage" class="hidden fixed inset-0 bg-[#3e2723] z-50 flex flex-col items-center justify-center text-white p-6 text-center fade-in">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 mb-4 text-[#d7ccc8]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <h2 class="text-2xl font-bold mb-2">‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</h2>
        <p class="text-[#d7ccc8]">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
    </div>

    <!-- Main Container -->
    <div id="mainContainer" class="hidden w-full max-w-4xl glass-card p-6 md:p-10 fade-in my-auto">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-2xl md:text-3xl font-bold text-[#3e2723] mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏ö‡∏â‡∏•‡∏≤‡∏Å‡πÉ‡∏ô‡∏á‡∏≤‡∏ô</h1>
            <p class="text-[#8d6e63] text-lg font-medium">‚ú® Luv Christmas 2025 ‚ú®</p>
        </div>

        <!-- Profile Section -->
        <div class="flex flex-col items-center mb-8">
            <div class="relative">
                <img id="userPicture" src="https://via.placeholder.com/150" alt="Profile" 
                     class="w-24 h-24 rounded-full border-4 border-[#d7ccc8] shadow-md object-cover">
                <div class="absolute bottom-0 right-0 bg-[#3e2723] text-white text-xs px-2 py-1 rounded-full">
                    LINE
                </div>
            </div>
            <h3 id="displayName" class="mt-3 text-lg font-semibold text-[#5d4037]">...</h3>
        </div>

        <!-- Message Box -->
        <div class="bg-[#efebe9] p-4 rounded-xl mb-6 border-l-4 border-[#8d6e63]">
            <p class="text-sm text-[#5d4037] leading-relaxed">
                ‚úçÔ∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ ü§çüéÑ
            </p>
        </div>

        <!-- Form -->
        <form id="registerForm" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô -->
                <div class="group">
                    <label class="block text-sm font-medium text-[#5d4037] mb-1">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô *</label>
                    <input type="text" id="nickname" required class="input-field w-full px-4 py-3 rounded-xl bg-white text-[#3e2723] placeholder-[#d7ccc8]" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏¢‡∏î‡πå">
                </div>

                <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á -->
                <div class="group">
                    <label class="block text-sm font-medium text-[#5d4037] mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á (‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ñ‡πâ‡∏≤‡∏™‡∏∞‡∏î‡∏ß‡∏Å)</label>
                    <input type="text" id="fullName" class="input-field w-full px-4 py-3 rounded-xl bg-white text-[#3e2723] placeholder-[#d7ccc8]" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                </div>

                <!-- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏Ñ‡∏£‡πå (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏•‡∏ö appearance-none ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô PC ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡∏•‡∏ö PASTOR/GL) -->
                <div class="group">
                    <label class="block text-sm font-medium text-[#5d4037] mb-1">‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏Ñ‡∏£‡πå</label>
                    <select id="careGroup" class="input-field w-full px-4 py-3 rounded-xl bg-white text-[#3e2723] cursor-pointer">
                        <option value="" disabled selected>-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏Ñ‡∏£‡πå --</option>
                        <option value="‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö">‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö</option>
                        <option value="Beyond Life">Beyond Life</option>
                        <option value="C.I.A">C.I.A</option>
                        <option value="EU">EU</option>
                        <option value="Fill-UP">Fill-UP</option>
                        <option value="Fulfill our soul">Fulfill our soul</option>
                        <option value="GOD7TH">GOD7TH</option>
                        <option value="Holy Life">Holy Life</option>
                        <option value="Indy">Indy</option>
                        <option value="Life in Christ">Life in Christ</option>
                        <option value="Life Kids">Life Kids</option>
                        <option value="Live Love Life">Live Love Life</option>
                        <option value="OCENIA">OCENIA</option>
                        <option value="Onsite R51">Onsite R51</option>
                        <option value="Onsite ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô">Onsite ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</option>
                        <option value="OREGON">OREGON</option>
                        <!-- PASTOR/GL removed -->
                        <option value="R.Y.F">R.Y.F</option>
                        <option value="Takecare Life">Takecare Life</option>
                        <option value="Young ‡∏ä‡∏∑‡πà‡∏ô‡∏ö‡∏≤‡∏ô">Young ‡∏ä‡∏∑‡πà‡∏ô‡∏ö‡∏≤‡∏ô</option>
                        <option value="‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á">‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á</option>
                        <option value="‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏Ñ‡∏£‡πå">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏Ñ‡∏£‡πå</option>
                    </select>
                </div>

                <!-- ‡∏ú‡∏π‡πâ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ -->
                <div class="group">
                    <label class="block text-sm font-medium text-[#5d4037] mb-1">‡πÉ‡∏Ñ‡∏£‡∏ä‡∏ß‡∏ô‡∏°‡∏≤‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</label>
                    <input type="text" id="referrer" class="input-field w-full px-4 py-3 rounded-xl bg-white text-[#3e2723] placeholder-[#d7ccc8]" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏ß‡∏ô">
                </div>
            </div>

            <!-- ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (Full Width on mobile) -->
            <div class="group">
                <label class="block text-sm font-medium text-[#5d4037] mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•)</label>
                <input type="tel" id="phone" class="input-field w-full px-4 py-3 rounded-xl bg-white text-[#3e2723] placeholder-[#d7ccc8]" placeholder="08x-xxx-xxxx">
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col gap-3 pt-4">
                <button type="submit" id="submitBtn" class="btn-coffee w-full text-white font-bold py-3.5 rounded-xl shadow-lg flex justify-center items-center gap-2">
                    <span id="btnText">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏à‡∏±‡∏ö‡∏â‡∏•‡∏≤‡∏Å</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </button>
                
                <button type="button" id="cancelBtn" class="hidden w-full bg-gray-200 text-gray-600 font-bold py-3.5 rounded-xl hover:bg-gray-300 transition-all">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
            </div>
        </form>
    </div>

    <!-- Script Configuration -->
    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbytjJTiMIqOuH68KHfAMUZIx2Y1Wc6w0pj6psaKyqMmBg_D0qoghFbg1uruK7-Y_EbAyg/exec';
        const LIFF_ID = '2008560135-QlLx9W3c';

        let userProfile = null;
        let isEditing = false;

        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }

                userProfile = await liff.getProfile();
                document.getElementById('userPicture').src = userProfile.pictureUrl || 'https://via.placeholder.com/150';
                document.getElementById('displayName').innerText = userProfile.displayName;

                checkUserRegistration(userProfile.userId);

            } catch (err) {
                console.error('LIFF Init Error', err);
                Swal.fire({ icon: 'error', iconColor: '#5d4037', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ' });
            }
        }

        async function checkUserRegistration(userId) {
            try {
                const response = await fetch(`${APPS_SCRIPT_URL}?action=check_user&userId=${userId}`);
                const result = await response.json();

                document.getElementById('loadingOverlay').classList.add('hidden');
                // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á mainContainer ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡πà‡∏≠

                if (result.status === 'success' && result.data.registered) {
                    // *** ‡∏Å‡∏£‡∏ì‡∏µ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ***
                    Swal.fire({
                        title: '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                        text: '‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ã‡πâ‡∏≥  ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ',
                        icon: 'info',
                        iconColor: '#5d4037', // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•
                        showCancelButton: true,
                        confirmButtonText: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        cancelButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö',
                        confirmButtonColor: '#3e2723',
                        cancelButtonColor: '#8d6e63',
                        reverseButtons: false // false = Confirm (Edit) on Left, Cancel (Ack) on Right
                    }).then((swalResult) => {
                        if (swalResult.isConfirmed) {
                            // ‡∏Å‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            document.getElementById('mainContainer').classList.remove('hidden');
                            populateForm(result.data);
                            enableEditMode();
                        } else {
                            // ‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö -> ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û
                            closeApp();
                        }
                    });

                } else {
                    // *** ‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà ***
                    document.getElementById('mainContainer').classList.remove('hidden');
                }

            } catch (error) {
                console.error('API Error', error);
                Swal.fire({
                    icon: 'error', 
                    iconColor: '#5d4037',
                    title: 'Error', 
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ'
                });
            }
        }

        function populateForm(data) {
            document.getElementById('nickname').value = data.nickname;
            document.getElementById('fullName').value = data.fullName;
            document.getElementById('careGroup').value = data.careGroup;
            document.getElementById('referrer').value = data.referrer;
            document.getElementById('phone').value = data.phone;
        }

        function enableEditMode() {
            isEditing = true;
            document.getElementById('btnText').innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            document.getElementById('cancelBtn').classList.remove('hidden');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
        function closeApp() {
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏ã‡πâ‡∏≥
            document.getElementById('mainContainer').classList.add('hidden');
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß
            document.getElementById('completedMessage').classList.remove('hidden');
            
            // ‡∏™‡∏±‡πà‡∏á‡∏õ‡∏¥‡∏î LIFF
            if (liff.isInClient()) {
                liff.closeWindow();
            }
        }

        document.getElementById('cancelBtn').addEventListener('click', () => {
            closeApp();
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            Swal.fire({
                title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...',
                html: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà',
                allowOutsideClick: false,
                didOpen: () => { Swal.showLoading() },
                background: '#fff',
                color: '#3e2723'
            });

            const formData = {
                action: isEditing ? 'update' : 'register',
                userId: userProfile.userId,
                displayName: userProfile.displayName,
                pictureUrl: userProfile.pictureUrl,
                statusMessage: userProfile.statusMessage,
                nickname: document.getElementById('nickname').value,
                fullName: document.getElementById('fullName').value,
                careGroup: document.getElementById('careGroup').value,
                referrer: document.getElementById('referrer').value,
                phone: document.getElementById('phone').value
            };

            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();

                if (result.status === 'success') {
                    let titleText = '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
                    let bodyText = 'ü§ç ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≥‡∏Ñ‡∏∑‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏±‡∏ö NexusLife<br>‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏±‡∏Å‡πÉ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡∏°‡∏≤‡∏™‡∏ô‡∏µ‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö üéÑ‚ú®';
                    
                    if (isEditing) {
                        titleText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢';
                        bodyText = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏•‡πâ‡∏ß ‚úÖ';
                    }

                    Swal.fire({
                        title: titleText,
                        html: bodyText,
                        icon: 'success',
                        iconColor: '#5d4037', // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•
                        confirmButtonText: '‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö', // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö
                        confirmButtonColor: '#3e2723'
                    }).then(() => {
                        closeApp(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏û‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏ß‡∏¢
                    });
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    iconColor: '#5d4037',
                    title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                    text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message
                });
            }
        });

        main();
    </script>
</body>
</html>
